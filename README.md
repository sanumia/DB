
# Система управления суши-рестораном

МДиСУБД
**Автор:** Городецкая Диана Анатольевна  
**Группа:** 353501  

---

## Оглавление
1.  [Общее описание](#общее-описание)
2.  [Функциональные требования](#функциональные-требования)
3.  [Описание структуры базы данных](#описание-структуры-базы-данных)
4.  [Схема связей между таблицами](#схема-связей-между-таблицами)

---

## Общее описание

Интернет-сайт суши-ресторана представляет собой многофункциональную платформу, предназначенную для полного цикла взаимодействия с клиентом — от выбора блюд до получения заказа.

Клиент может совершать весь процесс заказа интуитивно: знакомиться с подробным меню (с описанием, составом, весом и фотографией), формировать корзину, выбирать способ оплаты (онлайн или наличными) и время доставки. Система автоматически рассчитывает итоговую сумму, применяя акционные предложения.

После оформления пользователь может в реальном времени отслеживать статус своего заказа. Для постоянных гостей реализована система личных кабинетов с историей заказов и программой лояльности. Сайт является комплексным сервисом, обеспечивающим удобный, прозрачный и персонализированный опыт заказа еды с доставкой.

## Функциональные требования

1.  **Авторизация и аутентификация пользователей**
    *   Вход по логину и паролю.
    *   Шифрование паролей для безопасности.
    *   Проверка уникальности логина при регистрации.
    *   Восстановление пароля через email или телефон.
    *   Разграничение прав доступа по ролям.

2.  **Управление пользователями (CRUD) и система ролей**
    *   Клиенты могут регистрироваться самостоятельно.
    *   Администраторы управляют учетными записями сотрудников.
    *   Просмотр, редактирование, удаление/деактивация пользователей.
    *   Реализация системы ролей:
        *   **Клиент:** просмотр меню, оформление заказов, отслеживание доставки.
        *   **Администратор:** управление пользователями, меню, заказами, ингредиентами.
        *   **Повар:** доступ к заказам на кухне, изменение их статуса.
        *   **Курьер:** доступ к заказам на доставку, отметка о их выполнении.

3.  **Журналирование действий**
    *   Фиксация значимых событий: авторизация, изменения заказов, обновление профиля и т.д.
    *   Для каждой записи хранится: timestamp, ID пользователя, описание действия.
    *   Доступ к журналу только для администраторов.
    *   Срок хранения журнала — не менее 1 года.

4.  **Управление бизнес-процессами**
    *   Управление меню, заказами, доставкой и оплатой.
    *   Учет ингредиентов и складских остатков.
    *   Учет графика смен сотрудников.

## Описание структуры базы данных

### Справочники и основные сущности

| Таблица | Назначение |
| :--- | :--- |
| **`positions`** | Справочник должностей сотрудников. |
| **`order_statuses`** | Справочник всех возможных статусов заказа. |
| **`payments`** | Справочник доступных способов оплаты. |
| **`categories`** | Категории для группировки блюд в меню. |
| **`clients`** | База зарегистрированных клиентов ресторана. |
| **`employees`** | Учетные данные и информация о сотрудниках. |
| **`ingredients`** | Складской учет ингредиентов, их цен и остатков. |

### Бизнес-логика и транзакции

| Таблица | Назначение |
| :--- | :--- |
| **`orders`** | Центральная таблица, хранит сводную информацию по каждому заказу. |
| **`dishes`** | Меню ресторана с полным описанием, ценой и признаком доступности. |
| **`order_items`** | Детализация состава заказа, связывает заказы и блюда, фиксирует исторические цены. |
| **`dish_ingredients`** | Состав блюд, связывает блюда и ингредиенты с указанием требуемого количества. |
| **`deliveries`** | Управление процессом доставки: назначение курьеров, отслеживание времени. |
| **`discounts`** | Система скидок и акций, их условия и периоды действия. |


### Таблица **Clients**

* `ClientId` *(int, PK)* — уникальный идентификатор клиента.
* `Name` *(string, nvarchar(100))* — имя или ФИО клиента.
* `Phone` *(string, nvarchar(20))* — телефон.
* `Address` *(string, nvarchar(200))* — адрес доставки.
* `CreatedAt` *(DateTime)* — дата регистрации.

### Таблица **Positions**

* `PositionId` *(int, PK)* — уникальный идентификатор должности.
* `Title` *(string, nvarchar(50))* — название должности.

### Таблица **Employees**

* `EmployeeId` *(int, PK)* — уникальный идентификатор сотрудника.
* `PositionId` *(int, FK → Positions.PositionId)* — должность.
* `FirstName` *(string, nvarchar(50))* — имя.
* `LastName` *(string, nvarchar(50))* — фамилия.
* `Phone` *(string, nvarchar(20))* — телефон.
* `HireDate` *(DateTime)* — дата приёма на работу.
* `Salary` *(decimal(10,2))* — зарплата.

### Таблица **OrderStatuses**

* `StatusId` *(int, PK)* — уникальный идентификатор статуса.
* `Name` *(string, nvarchar(50))* — название статуса.

### Таблица **Payments**

* `PaymentId` *(int, PK)* — уникальный идентификатор способа оплаты.
* `MethodName` *(string, nvarchar(50))* — название метода оплаты.

### Таблица **Orders**

* `OrderId` *(int, PK)* — уникальный идентификатор заказа.
* `ClientId` *(int, FK → Clients.ClientId)* — клиент.
* `StatusId` *(int, FK → OrderStatuses.StatusId)* — статус заказа.
* `PaymentId` *(int, FK → Payments.PaymentId)* — способ оплаты.
* `DiscountId` *(int, FK → Discounts.DiscountId, nullable)* — скидка.
* `TotalAmount` *(decimal(10,2))* — сумма до скидки.
* `FinalAmount` *(decimal(10,2))* — сумма после скидки.
* `CreatedAt` *(DateTime)* — дата и время оформления.

### Таблица **Deliveries**

* `DeliveryId` *(int, PK)* — уникальный идентификатор доставки.
* `OrderId` *(int, FK → Orders.OrderId)* — заказ.
* `EmployeeId` *(int, FK → Employees.EmployeeId)* — курьер.
* `Address` *(string, nvarchar(200))* — адрес доставки.
* `DepartedAt` *(DateTime, nullable)* — время выезда курьера.
* `DeliveredAt` *(DateTime, nullable)* — время доставки.

### Таблица **Categories**

* `CategoryId` *(int, PK)* — уникальный идентификатор категории.
* `Name` *(string, nvarchar(50))* — название категории.
* `Description` *(string, nvarchar(200), nullable)* — описание категории.

### Таблица **Dishes**

* `DishId` *(int, PK)* — уникальный идентификатор блюда.
* `CategoryId` *(int, FK → Categories.CategoryId)* — категория.
* `Name` *(string, nvarchar(100))* — название блюда.
* `Description` *(string, nvarchar(300), nullable)* — описание.
* `WeightGrams` *(int)* — вес порции.
* `Price` *(decimal(10,2))* — цена.
* `IsAvailable` *(bool)* — доступность.

### Таблица **Ingredients**

* `IngredientId` *(int, PK)* — уникальный идентификатор ингредиента.
* `Name` *(string, nvarchar(100))* — название ингредиента.
* `UnitOfMeasure` *(string, nvarchar(20))* — единица измерения.
* `CurrentPrice` *(decimal(10,2))* — закупочная цена.
* `QuantityInStock` *(decimal(10,3))* — количество на складе.

### Таблица **OrderItems**

* `OrderItemId` *(int, PK)* — уникальный идентификатор позиции заказа.
* `OrderId` *(int, FK → Orders.OrderId)* — заказ.
* `DishId` *(int, FK → Dishes.DishId)* — блюдо.
* `Quantity` *(int)* — количество.
* `PriceAtTimeOfOrder` *(decimal(10,2))* — цена на момент заказа.

### Таблица **DishIngredients**

* `DishIngredientId` *(int, PK)* — уникальный идентификатор записи.
* `DishId` *(int, FK → Dishes.DishId)* — блюдо.
* `IngredientId` *(int, FK → Ingredients.IngredientId)* — ингредиент.
* `QuantityRequired` *(decimal(10,3))* — количество ингредиента.

### Таблица **Discounts**

* `DiscountId` *(int, PK)* — уникальный идентификатор скидки.
* `Name` *(string, nvarchar(100))* — название.
* `Description` *(string, nvarchar(200), nullable)* — описание условий.
* `DiscountType` *(string, nvarchar(20))* — тип (процент/сумма).
* `DiscountValue` *(decimal(10,2))* — значение скидки.
* `MinOrderAmount` *(decimal(10,2))* — минимальная сумма заказа.
* `StartDate` *(DateTime)* — дата начала.
* `EndDate` *(DateTime)* — дата окончания.
* `IsActive` *(bool)* — активность.
* `PromoCode` *(string, nvarchar(50), nullable)* — промокод.



## Связи между таблицами

* 1:М — `Clients` → `Orders`, `Positions` → `Employees`, `Categories` → `Dishes`, `Employees` → `Deliveries`.
* М:М — `Orders` ↔ `Dishes` (через `OrderItems`), `Dishes` ↔ `Ingredients` (через `DishIngredients`).
* 1:1 — `Orders` ↔ `Deliveries`.

## Схема связей между таблицами

### Связи «Один ко многим» (1:М)
*   `positions` ← `employees` (Одна должность — много сотрудников)
*   `clients` ← `orders` (Один клиент — много заказов)
*   `order_statuses` ← `orders` (Один статус — много заказов)
*   `payments` ← `orders` (Один способ оплаты — много заказов)
*   `categories` ← `dishes` (Одна категория — много блюд)
*   `employees` ← `deliveries` (Один курьер — много доставок)
*   `discounts` ← `orders` (Одна скидка — много заказов)

### Связи «Многие ко многим» (М:М) (через таблицы-связки)
*   `orders` ↔ `dishes` (через `order_items`)
*   `dishes` ↔ `ingredients` (через `dish_ingredients`)

### Связь «Один к одному» (1:1)
*   `orders` ↔ `deliveries` (Одному заказу соответствует одна доставка)
