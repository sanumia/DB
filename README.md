
# Система управления суши-рестораном

МДиСУБД
**Автор:** Городецкая Диана Анатольевна  
**Группа:** 353501  

---

## Оглавление
1.  [Общее описание](#общее-описание)
2.  [Функциональные требования](#функциональные-требования)
3.  [Описание структуры базы данных](#описание-структуры-базы-данных)
4.  [Схема связей между таблицами](#схема-связей-между-таблицами)

---

## Общее описание

Интернет-сайт суши-ресторана представляет собой многофункциональную платформу, предназначенную для полного цикла взаимодействия с клиентом — от выбора блюд до получения заказа.

Клиент может совершать весь процесс заказа интуитивно: знакомиться с подробным меню (с описанием, составом, весом и фотографией), формировать корзину, выбирать способ оплаты (онлайн или наличными) и время доставки. Система автоматически рассчитывает итоговую сумму, применяя акционные предложения.

После оформления пользователь может в реальном времени отслеживать статус своего заказа. Для постоянных гостей реализована система личных кабинетов с историей заказов и программой лояльности. Сайт является комплексным сервисом, обеспечивающим удобный, прозрачный и персонализированный опыт заказа еды с доставкой.

## Функциональные требования

1.  **Авторизация и аутентификация пользователей**
    *   Вход по логину и паролю.
    *   Шифрование паролей для безопасности.
    *   Проверка уникальности логина при регистрации.
    *   Восстановление пароля через email или телефон.
    *   Разграничение прав доступа по ролям.

2.  **Управление пользователями (CRUD) и система ролей**
    *   Клиенты могут регистрироваться самостоятельно.
    *   Администраторы управляют учетными записями сотрудников.
    *   Просмотр, редактирование, удаление/деактивация пользователей.
    *   Реализация системы ролей:
        *   **Клиент:** просмотр меню, оформление заказов, отслеживание доставки.
        *   **Администратор:** управление пользователями, меню, заказами, ингредиентами.
        *   **Повар:** доступ к заказам на кухне, изменение их статуса.
        *   **Курьер:** доступ к заказам на доставку, отметка о их выполнении.

3.  **Журналирование действий**
    *   Фиксация значимых событий: авторизация, изменения заказов, обновление профиля и т.д.
    *   Для каждой записи хранится: timestamp, ID пользователя, описание действия.
    *   Доступ к журналу только для администраторов.
    *   Срок хранения журнала — не менее 1 года.

4.  **Управление бизнес-процессами**
    *   Управление меню, заказами, доставкой и оплатой.
    *   Учет ингредиентов и складских остатков.
    *   Учет графика смен сотрудников.

## Описание структуры базы данных

### Справочники и основные сущности

| Таблица | Назначение |
| :--- | :--- |
| **`positions`** | Справочник должностей сотрудников. |
| **`order_statuses`** | Справочник всех возможных статусов заказа. |
| **`payments`** | Справочник доступных способов оплаты. |
| **`categories`** | Категории для группировки блюд в меню. |
| **`clients`** | База зарегистрированных клиентов ресторана. |
| **`employees`** | Учетные данные и информация о сотрудниках. |
| **`ingredients`** | Складской учет ингредиентов, их цен и остатков. |

### Бизнес-логика и транзакции

| Таблица | Назначение |
| :--- | :--- |
| **`orders`** | Центральная таблица, хранит сводную информацию по каждому заказу. |
| **`dishes`** | Меню ресторана с полным описанием, ценой и признаком доступности. |
| **`order_items`** | Детализация состава заказа, связывает заказы и блюда, фиксирует исторические цены. |
| **`dish_ingredients`** | Состав блюд, связывает блюда и ингредиенты с указанием требуемого количества. |
| **`deliveries`** | Управление процессом доставки: назначение курьеров, отслеживание времени. |
| **`discounts`** | Система скидок и акций, их условия и периоды действия. |

### Подробное описание полей таблиц

#### **`clients` (Клиенты)**
*   `client_id` — Уникальный идентификатор клиента (PK).
*   `name` — ФИО или имя клиента.
*   `phone` — Контактный телефон.
*   `address` — Стандартный адрес доставки.
*   `created_at` — Дата и время регистрации.

#### **`positions` (Должности)**
*   `position_id` — Уникальный идентификатор должности (PK).
*   `title` — Наименование должности (например, «Повар», «Курьер»).

#### **`employees` (Сотрудники)**
*   `employee_id` — Уникальный идентификатор сотрудника (PK).
*   `position_id` — Идентификатор должности (FK -> `positions`).
*   `first_name` — Имя сотрудника.
*   `last_name` — Фамилия сотрудника.
*   `phone` — Контактный телефон.
*   `hire_date` — Дата приема на работу.
*   `salary` — Размер оклада.

#### **`order_statuses` (Статусы заказов)**
*   `status_id` — Уникальный идентификатор статуса (PK).
*   `name` — Название статуса (напр., «Принят», «Готовится», «Доставлен»).

#### **`payments` (Способы оплаты)**
*   `payment_id` — Уникальный идентификатор способа оплаты (PK).
*   `method_name` — Название способа (напр., «Картой онлайн», «Наличными»).

#### **`orders` (Заказы)**
*   `order_id` — Уникальный номер заказа (PK).
*   `client_id` — Идентификатор клиента (FK -> `clients`).
*   `status_id` — Текущий статус заказа (FK -> `order_statuses`).
*   `payment_id` — Способ оплаты (FK -> `payments`).
*   `total_amount` — Итоговая сумма к оплате.
*   `created_at` — Дата и время создания заказа.
*   `discount_id` — Ссылка на примененную скидку (FK -> `discounts`).
*   `final_amount` — Итоговая сумма после применения скидок.

#### **`deliveries` (Доставки)**
*   `delivery_id` — Уникальный идентификатор доставки (PK).
*   `order_id` — Идентификатор заказа (FK -> `orders`).
*   `employee_id` — Идентификатор курьера (FK -> `employees`).
*   `address` — Адрес доставки.
*   `departed_at` — Время выезда курьера.
*   `delivered_at` — Время фактической доставки.

#### **`categories` (Категории блюд)**
*   `category_id` — Уникальный идентификатор категории (PK).
*   `name` — Название категории (напр., «Роллы», «Суши»).
*   `description` — Описание категории.

#### **`dishes` (Блюда)**
*   `dish_id` — Уникальный идентификатор блюда (PK).
*   `category_id` — Идентификатор категории (FK -> `categories`).
*   `name` — Название блюда.
*   `description` — Состав и описание.
*   `weight_grams` — Вес порции в граммах.
*   `price` — Цена.
*   `is_available` — Флаг доступности блюда.

#### **`ingredients` (Ингредиенты)**
*   `ingredient_id` — Уникальный идентификатор ингредиента (PK).
*   `name` — Название ингредиента.
*   `unit_of_measure` — Единица измерения (шт, гр, мл).
*   `current_price` — Текущая закупочная цена.
*   `quantity_in_stock` — Количество на остатке.

#### **`order_items` (Позиции заказа)**
*   `order_item_id` — Уникальный идентификатор позиции (PK).
*   `order_id` — Идентификатор заказа (FK -> `orders`).
*   `dish_id` — Идентификатор блюда (FK -> `dishes`).
*   `quantity` — Количество порций.
*   `price_at_time_of_order` — Цена блюда на момент оформления заказа.

#### **`dish_ingredients` (Состав блюд)**
*   `dish_ingredient_id` — Уникальный идентификатор связи (PK).
*   `dish_id` — Идентификатор блюда (FK -> `dishes`).
*   `ingredient_id` — Идентификатор ингредиента (FK -> `ingredients`).
*   `quantity_required` — Требуемое количество ингредиента для блюда.

#### **`discounts` (Скидки)**
*   `discount_id` — Уникальный идентификатор скидки (PK).
*   `name` — Название акции.
*   `description` — Описание условий.
*   `discount_type` — Тип скидки (процент/фиксированная сумма).
*   `discount_value` — Значение скидки.
*   `min_order_amount` — Минимальная сумма заказа для применения.
*   `start_date`, `end_date` — Период действия.
*   `is_active` — Флаг активности акции.
*   `promo_code` — Промокод (опционально).

## Схема связей между таблицами

### Связи «Один ко многим» (1:М)
*   `positions` ← `employees` (Одна должность — много сотрудников)
*   `clients` ← `orders` (Один клиент — много заказов)
*   `order_statuses` ← `orders` (Один статус — много заказов)
*   `payments` ← `orders` (Один способ оплаты — много заказов)
*   `categories` ← `dishes` (Одна категория — много блюд)
*   `employees` ← `deliveries` (Один курьер — много доставок)
*   `discounts` ← `orders` (Одна скидка — много заказов)

### Связи «Многие ко многим» (М:М) (через таблицы-связки)
*   `orders` ↔ `dishes` (через `order_items`)
*   `dishes` ↔ `ingredients` (через `dish_ingredients`)

### Связь «Один к одному» (1:1)
*   `orders` ↔ `deliveries` (Одному заказу соответствует одна доставка)
